<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MauiApp1.MainPage">

    <ScrollView>
        <VerticalStackLayout Spacing="25" Padding="30,0" VerticalOptions="Center">

            <!-- Header -->
            <Label x:Name="WelcomeLabel"
                   Text="Программа просмотра расписания"
                   FontSize="32"
                   HorizontalOptions="Center" />

            <!-- Branch Selection -->
            <Label Text="Выберите филиал:" FontSize="18" FontAttributes="Bold" />
            <Picker x:Name="BranchPicker"
                    Title="Выберите филиал"
                    SelectedIndexChanged="OnBranchSelectionChanged" />

            <!-- Employee Selection -->
            <Label Text="Выберите сотрудника:" FontSize="18" FontAttributes="Bold" />
            <Picker x:Name="EmployeePicker"
                    Title="Выберите сотрудника"
                    IsEnabled="False" />

            <!-- Date Selection -->
            <Label Text="Выберите дату:" FontSize="18" FontAttributes="Bold" />
            <DatePicker x:Name="ScheduleDatePicker" />

            <!-- Load Schedule Button -->
            <Button x:Name="LoadScheduleBtn"
                    Text="Загрузить расписание"
                    SemanticProperties.Hint="Load the schedule for selected parameters"
                    Clicked="OnLoadScheduleClicked"
                    HorizontalOptions="Fill" />

            <!-- Loading Indicator -->
            <ActivityIndicator x:Name="LoadingIndicator"
                               IsVisible="False"
                               IsRunning="False" />

            <!-- Schedule Display -->
            <Frame x:Name="ScheduleFrame"
                   IsVisible="False"
                   BackgroundColor="LightGray"
                   Padding="10">
                <CollectionView x:Name="ScheduleCollectionView">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="10" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto">
                                <Label Grid.Row="0"
                                       Text="{Binding DayHeader}"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="DarkBlue" />

                                <CollectionView Grid.Row="1"
                                                ItemsSource="{Binding Classes}"
                                                IsVisible="{Binding HasClasses}">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Frame Margin="5"
                                                   Padding="10"
                                                   BackgroundColor="White"
                                                   HasShadow="True">
                                                <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto">
                                                    <Label Grid.Row="0"
                                                           Text="{Binding TimeRange}"
                                                           FontAttributes="Bold"
                                                           TextColor="Red" />
                                                    <Label Grid.Row="1"
                                                           Text="{Binding Discipline}"
                                                           FontAttributes="Bold" />
                                                    <Label Grid.Row="2"
                                                           Text="{Binding Type}"
                                                           TextColor="Blue" />
                                                    <Label Grid.Row="3"
                                                           Text="{Binding Group}" />
                                                    <Label Grid.Row="4"
                                                           Text="{Binding ClassroomInfo}"
                                                           TextColor="Green" />
                                                    <Label Grid.Row="5"
                                                           Text="{Binding Employee}" />
                                                </Grid>
                                            </Frame>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                                <Label Grid.Row="2"
                                       Text="No classes scheduled"
                                       IsVisible="{Binding HasNoClasses}"
                                       TextColor="Black"
                                       Margin="10" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Frame>

            <!-- Chat AI Section -->
            <Label Text="Чат AI:" FontSize="18" FontAttributes="Bold" Margin="0,20,0,0" />

            <Frame BackgroundColor="DarkSlateGrey" Padding="10">
                <VerticalStackLayout>
                    <Label Text="AI Помощник"
                           FontSize="16"
                           TextColor="White"
                           FontAttributes="Bold"
                           HorizontalOptions="Center" />

                    <CollectionView x:Name="ChatHistoryView"
                                    HeightRequest="200">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Margin="5"
                                       Padding="8"
                                       BackgroundColor="{Binding BackgroundColor}">
                                    <VerticalStackLayout>
                                        <Label Text="{Binding Sender}"
                                               FontAttributes="Bold"
                                               FontSize="12" />
                                        <Label Text="{Binding Message}" />
                                        <Label Text="{Binding Timestamp}"
                                               FontSize="10"
                                               TextColor="Gray" />
                                    </VerticalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <Entry x:Name="ChatInput"
                           TextColor="White"
                           PlaceholderColor="White"
                           Placeholder="Введите ваше сообщение здесь..." />
                    <Button Text="Отправить сообщение"
                            Clicked="OnSendMessageClicked"
                            BackgroundColor="Black"
                            HorizontalOptions="Fill" />
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>